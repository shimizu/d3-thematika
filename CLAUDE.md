# Claude Code プロジェクト設定

このファイルは Claude Code がプロジェクトを理解するための設定ファイルです。

## プロジェクト概要

このプロジェクトは D3.js の主題図作成（thematika）ライブラリです。

### ライブラリの目的

- 更新の止まっているbertin.jsに変わって主にスタティックな主題図を作る主題図ライブラリを作成
- D3.jsの機能をフルに活用し、CSSやSVGのエフェクトを適用しやすい作りにする
- 一般的な地図ライブラリとは違い、パンやズームといった機能は持たない
- 目標とする地図スタイル: img/reference_map_style.png を参照

## 開発環境

- プラットフォーム: Linux (WSL2)
- 作業ディレクトリ: /home/shimizu/_make_libs/d3-thematika

## Git/GitHub設定

- リポジトリ: https://github.com/shimizu/d3-thematika.git
- メインブランチ: main
- GPG署名: 無効（--no-gpg-sign使用）
- コミット時はGPG署名なしで実行する必要があります
- コミットメッセージ: 日本語で作成する
- Push: 明示的な指示があるまで自動でpushしない

## 開発ワークフロー

- `npm run build`: プロダクションビルド
- `npm run dev`: 開発サーバー起動（http://localhost:3000/index.html）
- 開発サーバーは examples/ と dist/ フォルダをホスティング
- ライブリロード機能付き

### Examples作成時の必須手順

新しいデモページ（examples/*.html）を作成する場合は、必ず以下の手順に従ってください：

1. **テンプレートの内容を読む**: examples/template.html を参照
2. **テンプレートをコピー**: `cp examples/template.html examples/your-layer-name.html`
3. **テンプレートを修正**: 目的に合わせてテンプレートを修正
4. **不要な標準機能を削除**: 使用しない機能（透明度スライダー等）を削除

これにより全デモページで一貫したデザインとUXを維持できます。

## トークン削減戦略

Claude Code 使用時は以下の方法でトークン消費を最小限に抑える：

### ファイル読み込み最適化
- 初回ファイル確認は `compact` モード使用
- 必要に応じて `limit`/`offset` で部分読み込み
- Task/Agent ツールで事前調査してピンポイント特定

### 効率的な処理
- 複数ファイル読み込みを並列実行
- 独立したGitコマンドをバッチ処理
- MultiEdit で複数箇所を一括変更

### 開発アプローチ
- 実装前に構造とアプローチを明確化
- 小さな単位で段階的に進行
- キャッシュ活用で同一ファイル再読み込み回避

## 注意事項

- ファイルの変更や新規作成時は既存のコード規約に従ってください
- コミット前に必ずビルドとテストを実行してください

## メモリーログ

- ライブラリの正式名称は「d3-thematika」です。
- ライブラリは開発中のため後方互換を保つ必要はありません。
- 地理空間データ（GeoJSON）の計算処理はturf.jsを使用する。d3-thematikaは可視化に特化し、地理計算はturf.jsに委譲する。
- 設計を変更したときは不要になったコードを極力削除する
- **重要**: examples/フォルダにthematika.umd.jsをコピーする必要はない。rollup.config.jsのserve設定でcontentBase: ['examples', 'dist']により開発サーバーが両方を配信するため