import{B as tt,c as et,l as rt,M as it,G as nt}from"./story-helpers-DJRNUMPK.js";import*as g from"d3-geo";import{geoPath as ot}from"d3-geo";import{G as st}from"./geojson-layer-DyQVU0vZ.js";import"d3-selection";function d(e){return function(){return e}}const O=1e-12,A=Math.PI,b=2*A,f=1e-6,at=b-f;function R(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function ct(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return R;const r=10**t;return function(i){this._+=i[0];for(let n=1,o=i.length;n<o;++n)this._+=Math.round(arguments[n]*r)/r+i[n]}}class ht{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?R:ct(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,i,n){this._append`Q${+t},${+r},${this._x1=+i},${this._y1=+n}`}bezierCurveTo(t,r,i,n,o,s){this._append`C${+t},${+r},${+i},${+n},${this._x1=+o},${this._y1=+s}`}arcTo(t,r,i,n,o){if(t=+t,r=+r,i=+i,n=+n,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,c=this._y1,a=i-t,h=n-r,l=s-t,u=c-r,_=l*l+u*u;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(_>f)if(!(Math.abs(u*a-h*l)>f)||!o)this._append`L${this._x1=t},${this._y1=r}`;else{let p=i-s,y=n-c,E=a*a+h*h,K=p*p+y*y,P=Math.sqrt(E),j=Math.sqrt(_),N=o*Math.tan((A-Math.acos((E+_-K)/(2*P*j)))/2),v=N/j,z=N/P;Math.abs(v-1)>f&&this._append`L${t+v*l},${r+v*u}`,this._append`A${o},${o},0,0,${+(u*p>l*y)},${this._x1=t+z*a},${this._y1=r+z*h}`}}arc(t,r,i,n,o,s){if(t=+t,r=+r,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let c=i*Math.cos(n),a=i*Math.sin(n),h=t+c,l=r+a,u=1^s,_=s?n-o:o-n;this._x1===null?this._append`M${h},${l}`:(Math.abs(this._x1-h)>f||Math.abs(this._y1-l)>f)&&this._append`L${h},${l}`,i&&(_<0&&(_=_%b+b),_>at?this._append`A${i},${i},0,1,${u},${t-c},${r-a}A${i},${i},0,1,${u},${this._x1=h},${this._y1=l}`:_>f&&this._append`A${i},${i},0,${+(_>=A)},${u},${this._x1=t+i*Math.cos(o)},${this._y1=r+i*Math.sin(o)}`)}rect(t,r,i,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${i=+i}v${+n}h${-i}Z`}toString(){return this._}}function lt(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const i=Math.floor(r);if(!(i>=0))throw new RangeError(`invalid digits: ${r}`);t=i}return e},()=>new ht(t)}function _t(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function q(e){this._context=e}q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function X(e){return new q(e)}function ut(e){return e[0]}function pt(e){return e[1]}function ft(e,t){var r=d(!0),i=null,n=X,o=null,s=lt(c);e=typeof e=="function"?e:e===void 0?ut:d(e),t=typeof t=="function"?t:t===void 0?pt:d(t);function c(a){var h,l=(a=_t(a)).length,u,_=!1,p;for(i==null&&(o=n(p=s())),h=0;h<=l;++h)!(h<l&&r(u=a[h],h,a))===_&&((_=!_)?o.lineStart():o.lineEnd()),_&&o.point(+e(u,h,a),+t(u,h,a));if(p)return o=null,p+""||null}return c.x=function(a){return arguments.length?(e=typeof a=="function"?a:d(+a),c):e},c.y=function(a){return arguments.length?(t=typeof a=="function"?a:d(+a),c):t},c.defined=function(a){return arguments.length?(r=typeof a=="function"?a:d(!!a),c):r},c.curve=function(a){return arguments.length?(n=a,i!=null&&(o=n(i)),c):n},c.context=function(a){return arguments.length?(a==null?i=o=null:o=n(i=a),c):i},c}function H(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Y(e){this._context=e}Y.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:H(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:H(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function G(e){return new Y(e)}function W(e,t,r){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-r),e._x2,e._y2)}function M(e,t){this._context=e,this._k=(1-t)/6}M.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:W(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:W(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const dt=function e(t){function r(i){return new M(i,t)}return r.tension=function(i){return e(+i)},r}(0);function yt(e,t,r){var i=e._x1,n=e._y1,o=e._x2,s=e._y2;if(e._l01_a>O){var c=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,a=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*c-e._x0*e._l12_2a+e._x2*e._l01_2a)/a,n=(n*c-e._y0*e._l12_2a+e._y2*e._l01_2a)/a}if(e._l23_a>O){var h=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,l=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*h+e._x1*e._l23_2a-t*e._l12_2a)/l,s=(s*h+e._y1*e._l23_2a-r*e._l12_2a)/l}e._context.bezierCurveTo(i,n,o,s,e._x2,e._y2)}function I(e,t){this._context=e,this._alpha=t}I.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:yt(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const mt=function e(t){function r(i){return t?new I(i,t):new M(i,0)}return r.alpha=function(i){return e(+i)},r}(.5);function F(e){return e<0?-1:1}function B(e,t,r){var i=e._x1-e._x0,n=t-e._x1,o=(e._y1-e._y0)/(i||n<0&&-0),s=(r-e._y1)/(n||i<0&&-0),c=(o*n+s*i)/(i+n);return(F(o)+F(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(c))||0}function V(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function C(e,t,r){var i=e._x0,n=e._y0,o=e._x1,s=e._y1,c=(o-i)/3;e._context.bezierCurveTo(i+c,n+c*t,o-c,s-c*r,o,s)}function T(e){this._context=e}T.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:C(this,this._t0,V(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,C(this,V(this,r=B(this,e,t)),r);break;default:C(this,this._t0,r=B(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Q(e){this._context=new Z(e)}(Q.prototype=Object.create(T.prototype)).point=function(e,t){T.prototype.point.call(this,t,e)};function Z(e){this._context=e}Z.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,i,n,o){this._context.bezierCurveTo(t,e,i,r,o,n)}};function gt(e){return new T(e)}function wt(e){return new Q(e)}function J(e){this._context=e}J.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var i=D(e),n=D(t),o=0,s=1;s<r;++o,++s)this._context.bezierCurveTo(i[0][o],n[0][o],i[1][o],n[1][o],e[s],t[s]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function D(e){var t,r=e.length-1,i,n=new Array(r),o=new Array(r),s=new Array(r);for(n[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)n[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(n[r-1]=2,o[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)i=n[t]/o[t-1],o[t]-=i,s[t]-=i*s[t-1];for(n[r-1]=s[r-1]/o[r-1],t=r-2;t>=0;--t)n[t]=(s[t]-n[t+1])/o[t];for(o[r-1]=(e[r]+n[r-1])/2,t=0;t<r-1;++t)o[t]=2*e[t+1]-n[t+1];return[n,o]}function xt(e){return new J(e)}function L(e,t){this._context=e,this._t=t}L.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function kt(e){return new L(e,.5)}function $t(e){return new L(e,0)}function St(e){return new L(e,1)}class Tt extends tt{constructor(t){super(`line-connection-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,t.attr||{},t.style||{}),Array.isArray(t.data)?this.data={type:"FeatureCollection",features:t.data}:t.data.type==="Feature"?this.data={type:"FeatureCollection",features:[t.data]}:this.data=t.data,this.validateData(this.data),this.lineType=t.lineType||"straight",this.arcHeight=t.arcHeight||.3,this.arcControlPoint=t.arcControlPoint||"center",this.arcOffset=t.arcOffset||"perpendicular",this.startArrow=t.startArrow||!1,this.endArrow=t.endArrow||!1,this.arrowSize=t.arrowSize||10,this.smoothType=t.smoothType||"curveBasis"}validateData(t){if(!t||t.type!=="FeatureCollection")throw new Error("LineConnectionLayer: データはFeatureCollectionである必要があります");if(!Array.isArray(t.features))throw new Error("LineConnectionLayer: featuresが配列ではありません");t.features.forEach((r,i)=>{if(!r.geometry)throw new Error(`LineConnectionLayer: フィーチャー[${i}]にgeometryが存在しません`);const n=r.geometry,{type:o,coordinates:s}=n;if(o!=="LineString"&&o!=="MultiLineString")throw new Error(`LineConnectionLayer: フィーチャー[${i}]は'LineString'または'MultiLineString'である必要があります`);o==="LineString"?this.validateCoordinates(s,i):o==="MultiLineString"&&s.forEach((c,a)=>{this.validateCoordinates(c,i,a)})})}validateCoordinates(t,r,i){const n=i!==void 0?`[${r}]のライン[${i}]`:`[${r}]`;if(!Array.isArray(t)||t.length<2)throw new Error(`LineConnectionLayer: フィーチャー${n}は少なくとも2点の座標が必要です`);t.forEach((o,s)=>{if(!Array.isArray(o)||o.length<2)throw new Error(`LineConnectionLayer: フィーチャー${n}の座標[${s}]は[経度, 緯度]の配列である必要があります`);const[c,a]=o;if(c<-180||c>180)throw new Error(`LineConnectionLayer: フィーチャー${n}の座標[${s}]の経度は-180から180の範囲である必要があります`);if(a<-90||a>90)throw new Error(`LineConnectionLayer: フィーチャー${n}の座標[${s}]の緯度は-90から90の範囲である必要があります`)})}setProjection(t){this.projection=t,this.path=ot(t),this.layerGroup&&(this.layerGroup.selectAll("path").remove(),this.layerGroup.selectAll("defs").remove(),this.createArrowMarkers(),this.renderLines())}render(t){this.layerGroup=this.createLayerGroup(t),this.createArrowMarkers(),this.renderLines()}createArrowMarkers(){if(!this.layerGroup||!this.startArrow&&!this.endArrow)return;const t=`arrow-${this.id}`,r=this.layerGroup.append("defs").attr("class","thematika-line-connection-defs");this.startArrow&&r.append("marker").attr("id",`${t}-start`).attr("viewBox","0 0 10 10").attr("refX",0).attr("refY",5).attr("markerWidth",this.arrowSize/2).attr("markerHeight",this.arrowSize/2).attr("orient","auto-start-reverse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("fill",(typeof this.attr.stroke=="function"?"#333":this.attr.stroke)||"#333"),this.endArrow&&r.append("marker").attr("id",`${t}-end`).attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",this.arrowSize/2).attr("markerHeight",this.arrowSize/2).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("fill",(typeof this.attr.stroke=="function"?"#333":this.attr.stroke)||"#333")}renderLines(){if(!this.layerGroup||!this.path||!this.projection)return;const t=this.layerGroup.append("g").attr("class","thematika-line-connection-layer");this.data.features.forEach((r,i)=>{const n=r.geometry;n.type==="LineString"?this.renderLineString(t,n.coordinates,r,i):n.type==="MultiLineString"&&n.coordinates.forEach((o,s)=>{this.renderLineString(t,o,r,i,s)})})}renderLineString(t,r,i,n,o){if(this.lineType==="smooth")this.renderSmoothLineString(t,r,i,n,o);else for(let s=0;s<r.length-1;s++){const c={start:r[s],end:r[s+1],feature:i,segmentIndex:s,isFirst:s===0,isLast:s===r.length-2},a=t.append("path").datum(c).attr("d",l=>this.generateSegmentPath(l.start,l.end)).attr("class",()=>{const l="thematika-connection-line",u=this.attr.className||"",_=i.properties?.class||"",p=`segment-${s}`,y=o!==void 0?`line-${o}`:"";return[l,u,_,p,y].filter(Boolean).join(" ")}).style("fill","none"),h=`arrow-${this.id}`;this.startArrow&&c.isFirst&&a.attr("marker-start",`url(#${h}-start)`),this.endArrow&&c.isLast&&a.attr("marker-end",`url(#${h}-end)`),super.applyAllStylesToElement(a,this.layerGroup)}}generateSegmentPath(t,r){if(!this.projection)return"";const i=this.projection(t),n=this.projection(r);return!i||!n?"":this.lineType==="straight"?`M${i[0]},${i[1]}L${n[0]},${n[1]}`:this.lineType==="arc"?this.generateArcPath(t,r,i,n):this.lineType==="smooth"?`M${i[0]},${i[1]}L${n[0]},${n[1]}`:`M${i[0]},${i[1]}L${n[0]},${n[1]}`}generateArcPath(t,r,i,n){if(!this.projection)return"";const o=this.calculateBaseControlPoint(t,r,i,n);if(!o)return"";const s=this.applyArcOffset(o,i,n);return`M${i[0]},${i[1]}Q${s[0]},${s[1]} ${n[0]},${n[1]}`}calculateBaseControlPoint(t,r,i,n){if(!this.projection)return null;switch(this.arcControlPoint){case"center":const o=[(t[0]+r[0])/2,(t[1]+r[1])/2];return this.projection(o);case"weighted":const s=.5,c=[t[0]+(r[0]-t[0])*s,t[1]+(r[1]-t[1])*s];return this.projection(c);default:return Array.isArray(this.arcControlPoint)?this.projection(this.arcControlPoint):null}}applyArcOffset(t,r,i){const n=i[0]-r[0],o=i[1]-r[1],s=Math.sqrt(n*n+o*o);let c=0,a=0;switch(this.arcOffset){case"perpendicular":c=-o/s*this.arcHeight*s,a=n/s*this.arcHeight*s;break;case"north":a=-this.arcHeight*s;break;case"south":a=this.arcHeight*s;break;case"east":c=this.arcHeight*s;break;case"west":c=-this.arcHeight*s;break;default:Array.isArray(this.arcOffset)&&(c=this.arcOffset[0]*s,a=this.arcOffset[1]*s);break}return[t[0]+c,t[1]+a]}renderSmoothLineString(t,r,i,n,o){if(!this.projection)return;const s=this.geoSmoothPath(r);if(!s)return;const c={coordinates:r,feature:i,featureIndex:n,lineIndex:o},a=t.append("path").datum(c).attr("d",s).attr("class",()=>{const l="thematika-connection-line",u=this.attr.className||"",_=i.properties?.class||"",p=o!==void 0?`line-${o}`:"";return[l,u,_,p].filter(Boolean).join(" ")}).style("fill","none"),h=`arrow-${this.id}`;this.startArrow&&a.attr("marker-start",`url(#${h}-start)`),this.endArrow&&a.attr("marker-end",`url(#${h}-end)`),super.applyAllStylesToElement(a,this.layerGroup)}geoSmoothPath(t){if(!this.projection)return"";const r=t.map(o=>this.projection([o[0],o[1]])).filter(o=>o!==null);if(r.length<2)return"";const i=this.getCurveFunction();return ft().x(o=>o[0]).y(o=>o[1]).curve(i)(r)||""}getCurveFunction(){switch(this.smoothType){case"curveBasis":return G;case"curveCardinal":return dt;case"curveCatmullRom":return mt;case"curveLinear":return X;case"curveMonotoneX":return gt;case"curveMonotoneY":return wt;case"curveNatural":return xt;case"curveStep":return kt;case"curveStepAfter":return St;case"curveStepBefore":return $t;default:return G}}on(t,r){this.layerGroup&&this.layerGroup.selectAll("path").on(t,function(i,n){n.coordinates?r(i,{feature:n.feature,coordinates:n.coordinates,featureIndex:n.featureIndex,lineIndex:n.lineIndex}):r(i,{feature:n.feature,segmentIndex:n.segmentIndex,start:n.start,end:n.end,isFirst:n.isFirst,isLast:n.isLast})})}}const Mt={title:"Layers/LineConnectionLayer",tags:["autodocs"],parameters:{docs:{description:{component:"GeoJSON LineString/MultiLineString形式のデータで複数点間を結ぶラインを描画するレイヤー。直線またはアークで描画でき、矢印も表示可能です。"}}},argTypes:{lineType:{control:{type:"radio"},options:["straight","arc"],description:"ライン描画タイプ",defaultValue:"arc"},arcHeight:{control:{type:"range",min:0,max:1,step:.1},description:"アークの高さ（アークモード時）",defaultValue:.3},arcControlPoint:{control:{type:"radio"},options:["center","weighted"],description:"アーク制御点の位置",defaultValue:"center"},arcOffset:{control:{type:"radio"},options:["perpendicular","north","south","east","west"],description:"アークオフセットの方向",defaultValue:"perpendicular"},startArrow:{control:{type:"boolean"},description:"開始点に矢印を表示",defaultValue:!1},endArrow:{control:{type:"boolean"},description:"終了点に矢印を表示",defaultValue:!0},arrowSize:{control:{type:"range",min:5,max:20,step:1},description:"矢印のサイズ",defaultValue:10},stroke:{control:{type:"color"},description:"ライン色",defaultValue:"#e74c3c"},strokeWidth:{control:{type:"range",min:1,max:5,step:.5},description:"ライン幅",defaultValue:2},opacity:{control:{type:"range",min:0,max:1,step:.1},description:"透明度",defaultValue:.8},projection:{control:{type:"select"},options:["naturalEarth1","mercator","equirectangular","orthographic"],description:"投影法",defaultValue:"naturalEarth1"},dataType:{control:{type:"radio"},options:["simple","complex","multiline"],description:"データタイプ",defaultValue:"simple"}}};function U(e){const t=[{name:"東京",coords:[139.7,35.6]},{name:"ロンドン",coords:[-.1,51.5]},{name:"ニューヨーク",coords:[-74,40.7]},{name:"パリ",coords:[2.3,48.8]},{name:"シドニー",coords:[151.2,-33.8]},{name:"リオデジャネイロ",coords:[-43.2,-22.9]},{name:"カイロ",coords:[31.2,30]},{name:"モスクワ",coords:[37.6,55.7]},{name:"北京",coords:[116.4,39.9]},{name:"ムンバイ",coords:[72.8,19]}];switch(e){case"simple":return{type:"Feature",geometry:{type:"LineString",coordinates:[t[0].coords,t[1].coords]},properties:{name:"東京-ロンドン直行便",type:"flight"}};case"complex":return{type:"Feature",geometry:{type:"LineString",coordinates:[t[0].coords,t[8].coords,t[7].coords,t[3].coords,t[1].coords,t[2].coords,t[5].coords]},properties:{name:"世界一周ルート",type:"world-tour"}};case"multiline":return{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[t[0].coords,t[4].coords,t[9].coords]},properties:{name:"アジア太平洋ルート",type:"regional"}},{type:"Feature",geometry:{type:"LineString",coordinates:[t[1].coords,t[3].coords,t[6].coords,t[9].coords]},properties:{name:"ヨーロッパ・アジアルート",type:"regional"}},{type:"Feature",geometry:{type:"MultiLineString",coordinates:[[t[2].coords,t[5].coords],[t[5].coords,t[4].coords]]},properties:{name:"南半球ルート",type:"multi"}}]};default:return U("simple")}}function Lt(e,t,r){let i;switch(e){case"mercator":i=g.geoMercator();break;case"equirectangular":i=g.geoEquirectangular();break;case"orthographic":i=g.geoOrthographic().rotate([-50,-20]);break;case"naturalEarth1":default:i=g.geoNaturalEarth1();break}return i.scale(150).translate([t/2,r/2])}function m(e){const t=et();return Promise.all([rt()]).then(([r])=>{const o=Lt(e.projection,800,500);o.fitExtent([[20,20],[780,480]],r);const s=new it({container:"#map",width:800,height:500,projection:o,backgroundColor:"#f0f8ff"}),c=new st({data:r,attr:{fill:"#f5f5f5",stroke:"#ddd",strokeWidth:.5,opacity:.8}}),a=new nt({step:[30,30],attr:{fill:"none",stroke:"#eee",strokeWidth:.5,strokeDasharray:"2,2",opacity:.5}}),h=U(e.dataType),l=new Tt({data:h,lineType:e.lineType,arcHeight:e.arcHeight,arcControlPoint:e.arcControlPoint,arcOffset:e.arcOffset,startArrow:e.startArrow,endArrow:e.endArrow,arrowSize:e.arrowSize,attr:{stroke:e.stroke,strokeWidth:e.strokeWidth,opacity:e.opacity}});s.addLayer("graticule",a),s.addLayer("world",c),s.addLayer("connections",l),l.on("click",(u,_)=>{console.log("Connection clicked:",_),alert(`Clicked: ${_.feature.properties?.name||"Unknown route"}`)}),l.on("mouseover",(u,_)=>{console.log("Connection hover:",_)})}).catch(r=>{t.innerHTML=`<div style="color: red; padding: 20px;">エラー: ${r.message}</div>`}),t}const w={args:{lineType:"arc",arcHeight:.3,arcControlPoint:"center",arcOffset:"perpendicular",startArrow:!1,endArrow:!0,arrowSize:10,stroke:"#e74c3c",strokeWidth:2,opacity:.8,projection:"naturalEarth1",dataType:"simple"},render:m},x={args:{lineType:"arc",arcHeight:.4,arcControlPoint:"center",arcOffset:"perpendicular",startArrow:!0,endArrow:!0,arrowSize:12,stroke:"#9b59b6",strokeWidth:3,opacity:.9,projection:"naturalEarth1",dataType:"complex"},render:m},k={args:{lineType:"arc",arcHeight:.25,arcControlPoint:"center",arcOffset:"perpendicular",startArrow:!1,endArrow:!0,arrowSize:8,stroke:"#27ae60",strokeWidth:2,opacity:.7,projection:"naturalEarth1",dataType:"multiline"},render:m},$={args:{lineType:"straight",arcHeight:.3,arcControlPoint:"center",arcOffset:"perpendicular",startArrow:!1,endArrow:!0,arrowSize:10,stroke:"#f39c12",strokeWidth:2.5,opacity:.8,projection:"mercator",dataType:"simple"},render:m},S={args:{lineType:"arc",arcHeight:.5,arcControlPoint:"center",arcOffset:"perpendicular",startArrow:!0,endArrow:!0,arrowSize:15,stroke:"#e67e22",strokeWidth:3,opacity:1,projection:"orthographic",dataType:"complex"},render:m};w.parameters={...w.parameters,docs:{...w.parameters?.docs,source:{originalSource:`{
  args: {
    lineType: 'arc',
    arcHeight: 0.3,
    arcControlPoint: 'center',
    arcOffset: 'perpendicular',
    startArrow: false,
    endArrow: true,
    arrowSize: 10,
    stroke: '#e74c3c',
    strokeWidth: 2,
    opacity: 0.8,
    projection: 'naturalEarth1',
    dataType: 'simple'
  },
  render: createLineConnectionStory
}`,...w.parameters?.docs?.source}}};x.parameters={...x.parameters,docs:{...x.parameters?.docs,source:{originalSource:`{
  args: {
    lineType: 'arc',
    arcHeight: 0.4,
    arcControlPoint: 'center',
    arcOffset: 'perpendicular',
    startArrow: true,
    endArrow: true,
    arrowSize: 12,
    stroke: '#9b59b6',
    strokeWidth: 3,
    opacity: 0.9,
    projection: 'naturalEarth1',
    dataType: 'complex'
  },
  render: createLineConnectionStory
}`,...x.parameters?.docs?.source}}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  args: {
    lineType: 'arc',
    arcHeight: 0.25,
    arcControlPoint: 'center',
    arcOffset: 'perpendicular',
    startArrow: false,
    endArrow: true,
    arrowSize: 8,
    stroke: '#27ae60',
    strokeWidth: 2,
    opacity: 0.7,
    projection: 'naturalEarth1',
    dataType: 'multiline'
  },
  render: createLineConnectionStory
}`,...k.parameters?.docs?.source}}};$.parameters={...$.parameters,docs:{...$.parameters?.docs,source:{originalSource:`{
  args: {
    lineType: 'straight',
    arcHeight: 0.3,
    arcControlPoint: 'center',
    arcOffset: 'perpendicular',
    startArrow: false,
    endArrow: true,
    arrowSize: 10,
    stroke: '#f39c12',
    strokeWidth: 2.5,
    opacity: 0.8,
    projection: 'mercator',
    dataType: 'simple'
  },
  render: createLineConnectionStory
}`,...$.parameters?.docs?.source}}};S.parameters={...S.parameters,docs:{...S.parameters?.docs,source:{originalSource:`{
  args: {
    lineType: 'arc',
    arcHeight: 0.5,
    arcControlPoint: 'center',
    arcOffset: 'perpendicular',
    startArrow: true,
    endArrow: true,
    arrowSize: 15,
    stroke: '#e67e22',
    strokeWidth: 3,
    opacity: 1.0,
    projection: 'orthographic',
    dataType: 'complex'
  },
  render: createLineConnectionStory
}`,...S.parameters?.docs?.source}}};const Et=["Default","WorldTour","MultipleRoutes","StraightLines","OrthographicProjection"];export{w as Default,k as MultipleRoutes,S as OrthographicProjection,$ as StraightLines,x as WorldTour,Et as __namedExportsOrder,Mt as default};
