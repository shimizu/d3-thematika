<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point Symbol Layer - d3-thematika</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/responsive.css">
    <script src="./js/common.js"></script>

</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2L2 7V12C2 16.97 5.54 21.5 12 23C18.46 21.5 22 16.97 22 12V7L12 2M12 20.47C6.57 19.28 4 15.53 4 12V8.27L12 4.61L20 8.27V12C20 15.53 17.43 19.28 12 20.47Z"/>
                </svg>
                d3-thematika
            </a>
            <div class="nav-links">
                <a href="examples.html" class="nav-link">Examples</a>
                <a href="docs/" class="nav-link">Docs</a>
                <a href="https://github.com/shimizu/d3-thematika" class="nav-link">GitHub</a>
            </div>
        </div>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="main-container">
        <!-- ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ  -->
        <nav class="breadcrumb">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a href="index.html">Home</a>
                </li>
                <li class="breadcrumb-item breadcrumb-separator">></li>
                <li class="breadcrumb-item">
                    <a href="examples.html">Examples</a>
                </li>
                <li class="breadcrumb-item breadcrumb-separator">></li>
                <li class="breadcrumb-item breadcrumb-current">Point Symbol Layer</li>
            </ol>
        </nav>

        <section>
            <h2 class="section-title">Point Symbol Layer ãƒ‡ãƒ¢</h2>
            
            <div class="info-box">
                <h3>ğŸ”¸ PointSymbolLayeræ©Ÿèƒ½</h3>
                <ul>
                    <li>ãƒ‡ãƒ¼ã‚¿: examples/geojson/world.geojsonï¼ˆä¸–ç•Œåœ°å›³ãƒ‡ãƒ¼ã‚¿ï¼‰</li>
                    <li>ãƒ¬ã‚¤ãƒ¤ãƒ¼: PointSymbolLayerï¼ˆd3.symbolä½¿ç”¨ï¼‰ã€GraticuleLayerï¼ˆçµŒç·¯ç·šï¼‰</li>
                    <li>æ©Ÿèƒ½: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ã§ã‚·ãƒ³ãƒœãƒ«ã¨è‰²ã‚’è‡ªå‹•å‰²ã‚Šå½“ã¦ã€ã‚µã‚¤ã‚ºèª¿æ•´</li>
                    <li>ã‚«ãƒ©ãƒ¼: CARTO Safeãƒ‘ãƒ¬ãƒƒãƒˆä½¿ç”¨ï¼ˆè‰²è¦šéšœå®³å®Œå…¨å¯¾å¿œï¼‰</li>
                    <li>å¯¾å¿œ: ãƒã‚¤ãƒ³ãƒˆãƒ»ãƒãƒªã‚´ãƒ³ãƒ»ãƒ©ã‚¤ãƒ³ã®ä¸­å¿ƒç‚¹ã«ã‚·ãƒ³ãƒœãƒ«é…ç½®</li>
                </ul>
            </div>

            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
            <div class="controls-panel">
                <div class="control-item">
                    <label>ã‚µã‚¤ã‚º</label>
                    <div class="slider-control">
                        <input type="range" id="size-slider" min="16" max="256" step="16" value="64">
                        <span class="value-display" id="size-value">64</span>
                    </div>
                </div>
            </div>

            <!-- ãƒãƒƒãƒ—è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="map-wrapper">
                <div class="map-header">
                    <h3>åœ°å›³è¡¨ç¤º</h3>
                    <div class="download-buttons">
                        <button id="download-svg" class="download-button">SVG</button>
                        <button id="download-png" class="download-button">PNG</button>
                    </div>
                </div>
                <div id="map"></div>
            </div>
        </section>

        <!-- ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ« -->
        <section class="code-section">
            <h2 class="section-title">å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«</h2>
            
            <div class="code-header">
                <h3>PointSymbolLayerã®ä½¿ç”¨ä¾‹</h3>
                <button class="copy-button" onclick="copyCode()">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
            </div>
            <div class="code-block">
                <pre id="sample-code">// PointSymbolLayerã®ä½¿ç”¨ä¾‹ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•å‰²ã‚Šå½“ã¦ï¼‰

const geojson = await d3.json("./geojson/world.geojson");

// CARTO Safeãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆè‰²è¦šéšœå®³å®Œå…¨å¯¾å¿œï¼‰
const colorPalette = ['#88CCEE', '#CC6677', '#DDCC77', '#117733', '#332288', '#AA4499', '#44AA99', '#999933'];

const map = new Thematika.Map({
    container: '#map',
    width: 800,
    height: 600,
    projection: d3.geoNaturalEarth1()
});

// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ã§ã‚·ãƒ³ãƒœãƒ«ã¨è‰²ã‚’è‡ªå‹•å‰²ã‚Šå½“ã¦
const symbolLayer = new Thematika.PointSymbolLayer({
    data: geojson,
    size: 64, // å›ºå®šã‚µã‚¤ã‚º
    symbolType: (feature, index) => {
        // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«åŸºã¥ã„ã¦7ç¨®é¡ã®ã‚·ãƒ³ãƒœãƒ«ã‚’é †ç•ªã«ä½¿ç”¨
        const symbols = [
            d3.symbolCircle,
            d3.symbolCross,
            d3.symbolDiamond,
            d3.symbolSquare,
            d3.symbolStar,
            d3.symbolTriangle,
            d3.symbolWye
        ];
        return symbols[index % symbols.length];
    },
    attr: {
        "fill": (d, i) => colorPalette[i % colorPalette.length], // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§è‰²ã‚’å‰²ã‚Šå½“ã¦
        "stroke": '#2d3436',
        "stroke-width": 1,
        "opacity": 0.8
    }
});

// ã‚µã‚¤ã‚ºã‚‚å‹•çš„ã«è¨­å®šã™ã‚‹å ´åˆ
const dynamicSymbolLayer = new Thematika.PointSymbolLayer({
    data: geojson,
    size: (feature, index) => {
        // äººå£ã«åŸºã¥ã„ã¦ã‚µã‚¤ã‚ºã‚’æ±ºå®š
        const population = feature.properties?.POP_EST || 0;
        return Math.min(Math.sqrt(population / 1000000) * 32 + 16, 256);
    },
    symbolType: (feature, index) => {
        const symbols = [d3.symbolCircle, d3.symbolCross, d3.symbolDiamond, d3.symbolSquare, d3.symbolStar, d3.symbolTriangle, d3.symbolWye];
        return symbols[index % symbols.length];
    },
    attr: {
        "fill": (d, i) => colorPalette[i % colorPalette.length],
        "stroke": '#2d3436',
        "stroke-width": 0.5,
        "opacity": 0.8
    }
});

// ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
map.addLayer('graticule', graticuleLayer);
map.addLayer('symbols', symbolLayer);</pre>
            </div>
        </section>
    </div>

    <!-- UMDç‰ˆã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ -->
    <script src="./thematika.umd.js"></script>
    <script src="./js/common.js"></script>

    <script>
        // å…±é€šæ©Ÿèƒ½ã®åˆæœŸåŒ–
        initializeCommonFeatures();

        let map = null;
        let symbolLayer = null;
        let worldData = null;
        let baseSize = 64;
        

        // ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ç”¨ã®ãƒ‘ãƒ¬ãƒƒãƒˆæ¨å¥¨
        const colorPalette = Thematika.AllPalettes.TailwindVivid.colors       
        
        

        async function draw() {
            try {

                // åœ°å›³ã®å¯¸æ³•ã‚’å–å¾—
                const mapElement = document.querySelector('#map');
                const width = mapElement.clientWidth;
                const height = mapElement.clientHeight;

                // ä¸–ç•Œåœ°å›³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆåˆå›ã®ã¿ï¼‰
                if (!worldData) {
                    worldData = await d3.json('./geojson/world.geojson');
                }

                // æŠ•å½±æ³•ã‚’è¨­å®š
                const projection = d3.geoNaturalEarth1()
                    .fitExtent([[10, 10], [width-10, height-10]], worldData);

                // åœ°å›³ã‚’ä½œæˆ
                map = new Thematika.Map({
                    container: '#map',
                    width: width,
                    height: height,
                    projection: projection,
                    backgroundColor: '#ddd'
                });


                // èƒŒæ™¯ã®ä¸–ç•Œåœ°å›³ãƒ¬ã‚¤ãƒ¤ãƒ¼
                const worldLayer = new Thematika.GeojsonLayer({
                    data: worldData,
                    attr: {
                        "fill": '#333',
                        "stroke": '#fff',
                        "stroke-width": 0.5,
                        "opacity": 0.8
                    }
                });                

                // çµŒç·¯ç·šãƒ¬ã‚¤ãƒ¤ãƒ¼
                const graticuleLayer = new Thematika.GraticuleLayer({
                    step: [20, 20],
                    attr: {
                        "fill": 'none',
                        "stroke": '#666',
                        "stroke-width": 0.5,
                        "opacity": 0.6
                    }
                });

                                // OutlineLayerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
                const outlineLayer = new Thematika.OutlineLayer({
                    attr: {
                        "fill": 'none',
                        "stroke": '#2c3e50',
                        "stroke-width": 2,
                        "opacity": 0.8
                    }
                });


                // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ³ãƒœãƒ«ã‚¿ã‚¤ãƒ—è¨­å®š
                const symbolTypeFunction = (feature, index) => {
                    const symbols = [
                        d3.symbolCircle,
                        d3.symbolCross,
                        d3.symbolDiamond,
                        d3.symbolSquare,
                        d3.symbolStar,
                        d3.symbolTriangle,
                        d3.symbolWye
                    ];
                    return symbols[index % symbols.length];
                };

                // PointSymbolLayerã‚’ä½œæˆ
                symbolLayer = new Thematika.PointSymbolLayer({
                    data: worldData,
                    size: baseSize,
                    symbolType: symbolTypeFunction,
                    attr: {
                        "fill": (d, i) => colorPalette[i % colorPalette.length],
                        "stroke": '#2d3436',
                        "stroke-width": 1,
                        "opacity": 0.8
                    }
                });

                // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
                map.addLayer('graticule', graticuleLayer);
                map.addLayer('worldLayer', worldLayer);
                map.addLayer('symbols', symbolLayer);
                map.addLayer('outlineLayer', outlineLayer);


            } catch (error) {
                console.error('ãƒ‡ãƒ¢ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        // ã‚µã‚¤ã‚ºã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å¤‰æ›´
        document.getElementById('size-slider').addEventListener('input', function() {
            baseSize = parseInt(this.value);
            document.getElementById('size-value').textContent = this.value;
            draw();
        });


        // åˆæœŸæç”»
        draw();

        // SVGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        document.getElementById('download-svg').addEventListener('click', () => {
            map.saveSVG("map.svg");
        });
        
        // PNGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        document.getElementById('download-png').addEventListener('click', () => {
            map.savePNG("map.png")
        });

    </script>
</body>
</html>